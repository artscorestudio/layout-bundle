{# --------------------------------- Collection Form Type --------------------------------- #}
{% block collection_row %}
{% spaceless %}

    {% if prototype is defined %}
        {% set attr = attr|merge({'data-prototype': block("collection_item_widget") }) %}
    {% endif %}
    
    <div class="container-fluid wrapper-collection" id="{{ form.vars.id }}">
        <div class="row commands">
            <div class="col-xs-9">
                {{ form_label(form) }}
            </div>
            <div class="col-xs-3 text-right">
                <div class="btn-group btn-group-xs" role="group">
                    <a href="#" title="{{ 'add'|trans({}, 'asf_layout')|capitalize }}" class="btn btn-default item-add">{{ icon('plus') }}</a>
                </div>
            </div>
        </div>
        
        <div class="row">
            {{ form_errors(form) }}
        </div>
        
        <div class="row">
            <div {{ block('widget_container_attributes') }}>
                <table class="table table-striped table-bordered list-collection" id="list-collection-{{ form.vars.id }}">
                    {% set element_id = 0 %}
                    {% for item in form %}
                        <tr class="item" id="item-{{ element_id }}">
                            <td>
                                {{ form_widget(item) }}
                                {{ form_errors(item) }}
                            </td>
                            <td class="actions">
                                <a href="#" title="{{ 'delete'|trans({}, 'asf_layout')|capitalize }}" class="delete-item">{{ icon('remove') }}</a>
                            </td>
                        </tr>
                        {% set element_id = element_id + 1 %}
                    {% endfor %}
                </table>
            </div>
        </div>

        <script type="text/javascript">
        (function($, window, document) {
            var item_count_{{ form.vars.id }} = $('#{{ form.vars.id }} .list-collection .item').length;
            $('#{{ form.vars.id }} .item-add').click(function(e){
                e.preventDefault();
                
                var $collection = $('#{{ form.vars.id }} #list-collection-{{ form.vars.id }}')
                    , collectionParent = $collection.parent() 
                    , prototype = $(collectionParent).attr('data-prototype')
                    , prototype = prototype.replace(/{{ prototype.vars.name }}/g, item_count_{{ form.vars.id }}++)
                    , $prototype = $(prototype);

                $collection.append($prototype);
                $(this).trigger('collection:add', $prototype);
                
                $prototype.find('.delete-item').click(function(e){
                    e.preventDefault();
                    $(this).parent().parent().remove();
                    $('#{{ form.vars.id }}').trigger('collection:remove');
                });
            });

            $('#{{ form.vars.id }} .delete-item').click(function(e){
                e.preventDefault();
                $(this).parent().parent().remove();
                $('#{{ form.vars.id }}').trigger('collection:remove');
            });
        
        }(window.jQuery, window, document));
        </script>

    </div>

{% endspaceless %}
{% endblock %}

{% block collection_item_widget %}
{% spaceless %}
<tr class="item" id="item-{{ prototype.vars.name }}">
    <td>
    	{{ form_widget(prototype) }}
        {{ form_errors(prototype) }}
    </td>
    <td class="actions">
        <a href="#" title="{{ 'asf.layout.label.delete'|trans|capitalize }}" class="delete-item">{{ icon('remove') }}</a>
    </td>
</tr>
{% endspaceless %}
{% endblock %}

{# --------------------------------- Date Picker Form Type --------------------------------- #}
{% block date_picker_widget %}
{% spaceless %}
    {{- block('datetime_widget') -}}
    <script type="text/javascript">
    (function($, window, document) {
        $(function() {
            if (typeof $.datepicker !== 'undefined') {
                $("#{{ form.vars['id'] }} input").datepicker({dateFormat: 'yy-mm-dd'});
            } else if (window.console) {
                console.log('If you want to use LayoutBundle DatePicker Form Type, you have to add jQuery UI in your page. See artscorestudio/layout-bundle documentation.');
            }
        });
    }(window.jQuery, window, document));
    </script>
{% endspaceless %}
{% endblock %}
